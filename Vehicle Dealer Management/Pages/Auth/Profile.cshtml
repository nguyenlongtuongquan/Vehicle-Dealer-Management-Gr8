@page "/Profile"
@model Vehicle_Dealer_Management.Pages.Auth.ProfileModel
@{
    ViewData["Title"] = "Thông tin tài khoản";
    ViewData["UserRole"] = Model.UserRole;
    ViewData["UserName"] = Model.UserName;
}

<div class="content-header">
    <h1 class="content-title">Thông tin tài khoản</h1>
    <p class="content-subtitle">Xem và cập nhật thông tin cá nhân của bạn</p>
</div>

<div class="grid grid-cols-2">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Thông tin cá nhân</h3>
        </div>
        <div class="card-body">
            <form method="post">
                <div class="form-group">
                    <label class="form-label">Họ và tên</label>
                    <input type="text" class="form-control" name="fullName" value="@Model.User.FullName" required />
                </div>

                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" value="@Model.User.Email" readonly style="background: var(--black); cursor: not-allowed;" />
                    <small class="form-text">Email không thể thay đổi</small>
                </div>

                <div class="form-group">
                    <label class="form-label">Số điện thoại</label>
                    <input type="tel" class="form-control" name="phone" value="@Model.User.Phone" required />
                </div>

                <div class="form-group">
                    <label class="form-label">Vai trò</label>
                    <input type="text" class="form-control" value="@Model.User.Role?.Name" readonly style="background: var(--black); cursor: not-allowed;" />
                </div>

                @if (Model.User.Dealer != null)
                {
                    <div class="form-group">
                        <label class="form-label">Đại lý</label>
                        <input type="text" class="form-control" value="@Model.User.Dealer.Name" readonly style="background: var(--surface); cursor: not-allowed;" />
                    </div>
                }

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i>
                        Lưu thay đổi
                    </button>
                </div>

                @if (Model.SuccessMessage != null)
                {
                    <div style="background: var(--success-bg); color: var(--success); border: 1px solid var(--success); padding: 1rem; border-radius: var(--radius-sm); margin-top: 1rem;">
                        <i class="bi bi-check-circle"></i> @Model.SuccessMessage
                    </div>
                }
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Đổi mật khẩu</h3>
        </div>
        <div class="card-body">
            <form method="post" asp-page-handler="ChangePassword">
                <div class="form-group">
                    <label class="form-label">Mật khẩu hiện tại</label>
                    <input type="password" class="form-control" name="currentPassword" required />
                </div>

                <div class="form-group">
                    <label class="form-label">Mật khẩu mới</label>
                    <input type="password" class="form-control" name="newPassword" required />
                </div>

                <div class="form-group">
                    <label class="form-label">Xác nhận mật khẩu mới</label>
                    <input type="password" class="form-control" name="confirmPassword" required />
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-key"></i>
                        Đổi mật khẩu
                    </button>
                </div>

                @if (Model.PasswordError != null)
                {
                    <div style="background: var(--error-bg); color: var(--error); border: 1px solid var(--error); padding: 1rem; border-radius: var(--radius-sm); margin-top: 1rem;">
                        <i class="bi bi-exclamation-triangle"></i> @Model.PasswordError
                    </div>
                }

                @if (Model.PasswordSuccess != null)
                {
                    <div style="background: var(--success-bg); color: var(--success); border: 1px solid var(--success); padding: 1rem; border-radius: var(--radius-sm); margin-top: 1rem;">
                        <i class="bi bi-check-circle"></i> @Model.PasswordSuccess
                    </div>
                }
            </form>
        </div>
    </div>
</div>

<div class="card mt-3">
    <div class="card-header">
        <h3 class="card-title">Thông tin đăng nhập</h3>
    </div>
    <div class="card-body">
        <div class="grid grid-cols-3">
            <div>
                <p class="text-muted mb-1">Ngày tạo tài khoản</p>
                <p class="mb-0"><strong>@Model.User.CreatedAt.ToString("dd/MM/yyyy HH:mm")</strong></p>
            </div>
            <div>
                <p class="text-muted mb-1">ID Người dùng</p>
                <p class="mb-0"><strong>@Model.User.Id</strong></p>
            </div>
            <div>
                <p class="text-muted mb-1">Trạng thái</p>
                <p class="mb-0">@await Html.PartialAsync("_StatusBadge", "ACTIVE")</p>
            </div>
        </div>
    </div>
</div>


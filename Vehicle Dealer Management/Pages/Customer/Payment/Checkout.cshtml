@page "/Customer/Payment/Checkout"
@model Vehicle_Dealer_Management.Pages.Customer.Payment.CheckoutModel
@{
    ViewData["Title"] = "Thanh toán đơn hàng";
    ViewData["UserRole"] = "CUSTOMER";
    ViewData["UserName"] = HttpContext.Session.GetString("UserName") ?? "Customer";
}

@await Html.PartialAsync("_PageHeader")

<div class="content-header">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="content-title">Thanh toán đơn hàng</h1>
            <p class="content-subtitle">Chọn phương thức thanh toán online</p>
        </div>
        <a href="/Customer/OrderDetail?id=@Model.OrderId" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Quay lại
        </a>
    </div>
</div>

@if (TempData["Error"] != null)
{
    <div class="alert alert-error mb-4">
        <i class="bi bi-exclamation-triangle"></i> @TempData["Error"]
    </div>
}

<div class="grid grid-cols-2 gap-4">
    <!-- Left: Order Summary -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Thông tin đơn hàng</h3>
        </div>
        <div class="card-body">
            <div style="margin-bottom: 1rem;">
                <div class="text-muted" style="font-size: 0.875rem;">Mã đơn hàng</div>
                <div style="font-size: 1.25rem; font-weight: 600;">@Model.OrderNumber</div>
            </div>
            <div style="margin-bottom: 1rem;">
                <div class="text-muted" style="font-size: 0.875rem;">Tổng tiền đơn hàng</div>
                <div style="font-size: 1.5rem; font-weight: 600; color: var(--accent-cyan);">
                    @Model.TotalAmount.ToString("N0") VND
                </div>
            </div>
            <div style="margin-bottom: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                <div class="text-muted" style="font-size: 0.875rem;">Số tiền cần thanh toán</div>
                <div style="font-size: 1.75rem; font-weight: 700; color: var(--warning);">
                    @Model.RemainingAmount.ToString("N0") VND
                </div>
            </div>
        </div>
    </div>

    <!-- Right: Payment Methods -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Chọn phương thức thanh toán</h3>
        </div>
        <div class="card-body">
            <div class="grid grid-cols-1 gap-3">
                <!-- MoMo -->
                <form method="post" asp-page-handler="ProcessPayment" style="margin: 0;">
                    <input type="hidden" name="orderId" value="@Model.OrderId" />
                    <input type="hidden" name="provider" value="momo" />
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1.5rem; text-align: left; justify-content: flex-start;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 3rem; height: 3rem; background: var(--surface); border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-wallet2" style="font-size: 2rem; color: #AF0B0E;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; font-size: 1.125rem;">Ví MoMo</div>
                                <div class="text-muted" style="font-size: 0.875rem;">Thanh toán qua ứng dụng MoMo</div>
                            </div>
                        </div>
                    </button>
                </form>

                <!-- MoMo ATM -->
                <form method="post" asp-page-handler="ProcessPayment" style="margin: 0;">
                    <input type="hidden" name="orderId" value="@Model.OrderId" />
                    <input type="hidden" name="provider" value="momo_atm" />
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1.5rem; text-align: left; justify-content: flex-start;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 3rem; height: 3rem; background: var(--surface); border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-credit-card-2-front" style="font-size: 2rem; color: #AF0B0E;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; font-size: 1.125rem;">Thẻ ATM (Napas)</div>
                                <div class="text-muted" style="font-size: 0.875rem;">Thanh toán qua cổng MoMo bằng thẻ test Napas</div>
                            </div>
                        </div>
                    </button>
                </form>

                <!-- VNPay -->
                <form method="post" asp-page-handler="ProcessPayment" style="margin: 0;">
                    <input type="hidden" name="orderId" value="@Model.OrderId" />
                    <input type="hidden" name="provider" value="vnpay" />
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1.5rem; text-align: left; justify-content: flex-start;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 3rem; height: 3rem; background: var(--surface); border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-credit-card" style="font-size: 2rem; color: #0066CC;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; font-size: 1.125rem;">VNPay</div>
                                <div class="text-muted" style="font-size: 0.875rem;">Thanh toán qua cổng VNPay</div>
                            </div>
                        </div>
                    </button>
                </form>

                @if (Model.CanPayCash)
                {
                    <!-- Cash payment -->
                    <form method="post" asp-page-handler="PayCash" style="margin: 0;">
                        <input type="hidden" name="orderId" value="@Model.OrderId" />
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1.5rem; text-align: left; justify-content: flex-start;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="width: 3rem; height: 3rem; background: var(--surface); border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-cash-coin" style="font-size: 2rem; color: var(--success);"></i>
                                </div>
                                <div>
                                    <div style="font-weight: 600; font-size: 1.125rem;">Tiền mặt tại đại lý</div>
                                    <div class="text-muted" style="font-size: 0.875rem;">Thanh toán trực tiếp số tiền còn lại @Model.RemainingAmount.ToString("N0") VND</div>
                                </div>
                            </div>
                        </button>
                    </form>
                }
            </div>
        </div>
    </div>
</div>

